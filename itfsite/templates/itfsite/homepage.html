{% extends "master.html" %}
{% load itfsite_utils %}

{% block title2 %}if.then.fund - {% include "tagline.txt" %}{% endblock %}

{% block head %}
<meta name="og:title" content="if.then.fund" />
<meta name="description" content="{% include "tagline.txt" %}">
<meta name="og:description" content="{% include "tagline.txt" %}">
<meta property="og:image" content="{{ROOT_URL}}static/img/logo.png" /> {# for Twitter summary card, mix size 120x120 #}
<meta name="twitter:card" content="summary" />

<style>
@import url(https://fonts.googleapis.com/css?family=Roboto+Condensed:700);

.navbar {
	background: none;
	margin-bottom: 0;
}
	.navbar > .container {
		padding-right: 0;
		margin-right: 0;
	}
	.navbar-brand {
		display: none;
	}
	.navbar a {
		background: none;
		color: #777;
	}
		.navbar .nav a:hover {
			text-decoration: none;
			background: #333;
		}

#banner {
	background-repeat: no-repeat;
	background-size: 100%;
	background-image: url('/static/img/capitol.jpg');
	background-position: 0 100%;
	margin-bottom: 50px;
	cursor: default;
}
	@media screen and (max-width: 850px) {
		#banner {
			background-size: auto 100%;
			background-position: 75% 0;
			margin-bottom: 25px;
		}
	}

	#banner > h1, #banner > #deck {
		margin-left: 10vw;
		margin-right: 8vw;
	}

	h1 {
		font-family: 'Roboto Condensed', sans-serif;
		font-weight: bold;

		margin-top: .5em;
		margin-bottom: 0;
		background-color: rgba(90,170,40, .5);
		color: white;
		padding: .1em 20px .06em 20px;
		font-size: 40px;
	}

	#deck {
		margin-top: 80px;
		margin-bottom: 80px;
		background-color: rgba(200,200,200, .83);
		padding: 10px 20px;
		font-size: 18px;
		line-height: 150%;
		font-family: 'Roboto Slab', serif;
		color: black;
	}

	@media screen and (min-width: 440px) and (max-width: 1200px) {
		h1 {
			font-size: 65px;
			font-size: 8vw;
		}
		#deck {
			font-size: 24px;
		}
	}
	@media screen and (min-width: 1200px) {
		h1 {
			margin-top: 10vw;
			font-size: 110px;
		}
		#deck {
			font-size: 24px;
		}
	}

	#scroll-me-down {
		display: block;
		margin: -60px auto 20px auto;
		width: 8em;
		padding: .5em;
		height: 40px;
		border: none;
		text-align: center;
		background-color: #353;
		color: white;
		font-family: 'Roboto Condensed', sans-serif;
	}

.expl {
	margin: 2em 0 1em 0;
	color: #555;
}

.trigger-list {
	list-style: none;
	padding: 0;
}
	.trigger-list li {
		margin-bottom: 1em;
	}
	.trigger-list li a {
		font-family: 'Roboto Slab', serif;
		color: #A53;
		font-weight: bold;
		border: none;
	}
		.trigger-list li a:hover {
			text-decoration: underline;
		}
	.trigger-list li span {
		font-style: italic;
	}
</style>
{% endblock %}

{% block body-wide %}
<div id="homepage" class="container-fluid">
	<div id="banner" class="row">
		{% include "navbar.html" %}

		<h1><span>if<span class='p1'>.</span>then<span class='p2'>.</span>fund<span class='p3'></span></span></h1>
		<div id="deck">
			Reshaping Congress by empowering <strong>small dollar donors</strong> to make contributions based on <strong>what politicians do</strong> — not what they promise.
		</div>
		<a id="scroll-me-down" style="display: none" href="#" onclick="smooth_scroll_to($('#homepage-body')); return false;">
			↓ SCROLL ↓
		</a>
	</div>
</div>


<div id="homepage-body" class="container">
	<div class="row">
		{% if open_triggers|length > 0 %}
		<div class="col-md-7">
			<h3 class="invert"><span>Upcoming votes</span></h3>
			<p class="expl">Make a contribution to senators, representatives, or their next opponents based on the outcome of one of these upcoming votes:</p>
			<ul class="trigger-list">
				{% for t in open_triggers %}
					<li>
						<div><a href="{{t.get_absolute_url}}">{{t.title}}</a></div>
						<div>
							<span>{{t.total_pledged|currency}} committed so far</span>
							&mdash; <a href="{{t.get_absolute_url}}" style="text-decoration: underline">Take Action</a>
						</div>
					</li>
				{% endfor %}
			</ul>
		</div>
		{% endif %}

		{% if recent_executed_triggers|length > 0 %}
		<div class="col-md-{% if open_triggers|length > 0 %}5{% else %}12{% endif %}">
			<div class="{% if open_triggers|length > 0 %}col-md-left-border{% endif %}">
				<div class="visible-xs visible-sm" style="height: 1em"> </div>
				<h3 class="invert"><span>Recently</span></h3>
				<p class="expl">Check out recent votes our users made campaign contributions about:</p>
				<ul class="trigger-list">
					{% for t in recent_executed_triggers %}
						<li>
							{{t.title}}
							<br><span>
							{% for outcome in t.execution.get_outcomes %}
								{{outcome.label}}: {{outcome.contribs|currency}}
								{% if not forloop.last %} | {% endif %}
							{% endfor %}</span>
							<br><a href="{{t.get_absolute_url}}">view details</a>
						</li>
					{% endfor %}
				</ul>
			</div>
		</div>
		{% endif %}
	</div>

	<div>
		<hr>

		<h2>Why we&rsquo;re doing this</h2>

		<p>By targeting real outcomes, shaping the next Congress, aggregating donations, and reaching all members of Congress, we hope to raise the tide of small-donor supporters and shift the balance of power away from concentrated wealth. Read <a href="/about">more about the site</a> for more details.</p>

	</div>

	{# outer div is closed in master.html #}

{% endblock %}

{% block scripts %}
<style>
.splash-anim-bubble {
	border: 1px solid #FFF;
	border-radius: 15px;
	background-color: #38601f;
	padding: 7px 5px;
	color: white;
	font-family: sans-serif;
	text-align: center;
	line-height: 110%;
	cursor: default;
}
.splash-anim-bubble span {
	font-family: 'Roboto Condensed', sans-serif;
	font-weight: bold;
	font-size: 120%;
}
</style>

<script>
$(function() {
	if ($(window).width() > 480 && !$('body').hasClass('ie8'))
		setTimeout(start_splash_animation, 500);
})

function start_splash_animation() {
	// Get dimensions.
	var total_width = $('h1').innerWidth();
	var text_width = $('h1 span').outerWidth();
	var dot_width = $('h1 .p1').width();
	var p1width = .475 * (total_width - text_width); // first period
	var p2width = .05 * (total_width - text_width); // second period
	var p3width = .475 * (total_width - text_width); // after 'fund'
	$('h1 .p1').animate({
		paddingLeft: (p1width-dot_width)/2, paddingRight: (p1width-dot_width)/2,
		opacity: .5 })
	$('h1 .p2').animate({
		paddingLeft: p2width/2, paddingRight: p2width/2,
		opacity: .5
		}, start_anims)

	function start_anims() {
		// This has to delay until after the first set of p1/p2
		// animations are done above so that the horizontal location
		// for the second bubble is known.

		// Does a single iteration of a bubble.
		function make_bubble(pelem, pwidth, duration, text) {
			var b = $('<div class="splash-anim-bubble"></div>').clone();
			b.html(text);

			$('body').append(b);
			b.css({
				position: 'absolute',
				left: pelem.offset().left + .1*pwidth,
				top: $('h1').offset().top + 2*$('h1').height(),
				width: .8 * pwidth,
				fontSize: pwidth/11,
				opacity: 0
			})
			b
				.animate({
					top: $('h1').offset().top + $('h1').height()/2 - b.height()/2,
					opacity: 1
				}, duration/4)
				.delay(3*duration/4)
				.animate({
					top: $('h1').offset().top - b.height()*2,
					opacity: 0
				}, duration/4, function() {
					b.remove()
				})
		}

		// Create bubbles indefinitely.
		var anim_duration = 4500;
		var anim_counter = 0;
		var anim_text = [ ];
		for (var a1 in { representative: null, senator: null }) {
			for (var a2 in { 'supports': null, 'oppposes': null }) {
				anim_text.push(['a ' + a1 + '<br><span>' + a2 + '</span><br>your position',
						(a2 == 'supports') ? "<span>their reelection</span>" : "their <span>opponent</span>"
						])
			}
		}
		function do_anim() {
			make_bubble($('h1 .p1'), p1width, anim_duration, anim_text[anim_counter][0]);
			make_bubble($('h1 .p3'), p3width, anim_duration, anim_text[anim_counter][1]);
			anim_counter = (anim_counter + 1) % anim_text.length;
			setTimeout(do_anim, anim_duration);
		}
		do_anim(); // start

		// If the window height is too short and the <h3>s aren't visible,
		// show an arrow to suggest the user scroll down.
		if ($('#homepage-body h3').offset().top + $('#homepage-body h3').height() > $(window).height())
			setTimeout("if ($(window).scrollTop() == 0) $('#scroll-me-down').fadeIn();", 2000)
	}
}
</script>
{% endblock %}
